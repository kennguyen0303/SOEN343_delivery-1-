<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play with this page ! </title>
</head>
<body>
    <button onclick="renderLayout()">Click to render the layout</button>
    <button onclick="startGame()">Click to render the doors and windows</button>
    <canvas id="myCanvas" width="500" height="400"
style="border:1px solid black;">
Your browser does not support the canvas element.
</canvas>
   <h3>Controlling: </h3>
   <select name="" id="control_option">
       <option value="1">1</option>
       <option value="2">2</option>
   </select>
   <h4>Use arrow button to move </h4>
   <script>
    /**
    *Header 
    *@return a layout
    */
   function renderLayout()//a function for rendering the layout of the house
   {
        var xmlhttp = new XMLHttpRequest();//creating a request for AJAX to load the layout
            xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {//when the layout file is successfully loaded, executes the below codes
            myObj = JSON.parse(this.responseText);//parse the JSON data to an JAvascript object
            var canvas = document.getElementById("myCanvas");//define the area to draw
            var ctx = canvas.getContext("2d");//a syntax concept, check the w3school
            //drawing starts here
            for (var key1 of Object.keys(myObj)) {//loop over each room in the JSON file, syntax here: loop over an object
                for (var key2 of Object.keys(myObj[key1])) {//loop over each element for a room
                    //print room_name p/s: hardcode name position need to fix later
                    if(key2=="name"){//if the element is "name", need to print out
                        ctx.font = "15px Arial";//set the font
                        if(myObj[key1][key2]=="kitchen") ctx.fillText(myObj[key1][key2],200,30);//ctx.fillText(content,x,y): specify the place to print
                        if(myObj[key1][key2]=="living room") ctx.fillText(myObj[key1][key2],20,50);
                    }
                    //draw the wall and leave space for door, window
                    if(myObj[key1][key2].length>4){// having more than 2 points, meaning need to draw two lines and leave a space for doors,windows
                        ctx.moveTo(myObj[key1][key2][0],myObj[key1][key2][1]);
                        ctx.lineTo(myObj[key1][key2][2],myObj[key1][key2][3]);
                        ctx.stroke();
                        ctx.moveTo(myObj[key1][key2][4],myObj[key1][key2][5]);
                        ctx.lineTo(myObj[key1][key2][6],myObj[key1][key2][7]);
                        ctx.stroke();
                    }
                    else{//no need for door/window, will have 2 coordinate (x1,y1), (x2,y2) make a total 4 points in the array
                        ctx.moveTo(myObj[key1][key2][0],myObj[key1][key2][1]);
                        ctx.lineTo(myObj[key1][key2][2],myObj[key1][key2][3]);
                        ctx.stroke();
                    }
                    
                };//finish rendering a room
                //how to deal with window and door object ? since need to create a controller for it later on
                
            };
        
        
        }
        };
        xmlhttp.open("GET", "layout.json", true);
        xmlhttp.send();
            
   }
   //try the game code from w3school with some modification, check w3school for more detials
   var myGamePiece;
   var door2;
   var being_on=true;
   var option;
function startGame() {
    myGameArea.start();
    myGamePiece = new component(20, 20, "red", 40, 200);
    door2=new component(20, 20, "red", 130, 40);
}

var myGameArea = {
    canvas : document.getElementById("myCanvas"),
    start : function() {
        //challenge: fix the movement ? Using a standard button ON/OFF is the best
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.interval = setInterval(updateGameArea, 20);
        window.addEventListener('keydown', function (e) {
            myGameArea.key = e.keyCode;
        })
        window.addEventListener('keyup', function (e) {
            myGameArea.key = false;
        })
    }, 
    clear : function(){
        this.context.clearRect(0, 200, this.canvas.width, this.canvas.height);
        this.context.clearRect(130, 0, 20, this.canvas.height);
    }
}

function component(width, height, color, x, y) {
    this.gamearea = myGameArea;
    this.width = width;
    this.height = height;
    this.speedX = 0;
    this.speedY = 0;    
    this.x = x;
    this.y = y;    
    this.update = function() {
        ctx = myGameArea.context;
        ctx.fillStyle = color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
    }
    this.newPos = function() {
        this.x += this.speedX;
        this.y += this.speedY;        
    }
}

function updateGameArea() {
    myGameArea.clear();
    myGamePiece.speedX = 0;
    myGamePiece.speedY = 0;  
    door2.speedX = 0;
    door2.speedY = 0;  
    var option = document.getElementById("control_option").value;
    if (myGameArea.key && myGameArea.key == 37) {
        if(option==1) myGamePiece.speedX = -1;
        if(option==2) door2.speedX = -1;
         }
    if (myGameArea.key && myGameArea.key == 38) {
        if(option==2) door2.speedY = -1; }  
    if (myGameArea.key && myGameArea.key == 39) {
        if(option==1) myGamePiece.speedX = 1;
        if(option==2) door2.speedX = 1; 
    }
    if (myGameArea.key && myGameArea.key == 40) {
        if(option==2) door2.speedY = 1;
    
    }
        //key in control is the update function
    
    myGamePiece.newPos();    
    myGamePiece.update();
    door2.newPos();    
    door2.update();
}
    </script>
</body>
</html>